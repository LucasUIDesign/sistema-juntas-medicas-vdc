// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Modelo de Usuario
model User {
  id            String        @id @default(uuid())
  username      String        @unique
  email         String        @unique
  password      String
  nombre        String?
  apellido      String?
  dni           String?
  telefono      String?
  fotoUrl       String?
  role          String        @default("ADMIN")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  juntas        JuntaMedica[] @relation("MedicoJuntas")
  turnos        Turno[]       @relation("MedicoTurnos")
}

// Modelo de Paciente
model Paciente {
  id              String        @id @default(uuid())
  nombre          String
  apellido        String
  numeroDocumento String        @unique
  correo          String?
  telefono        String?
  domicilio       String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  juntas          JuntaMedica[] @relation("PacienteJuntas")
  turnos          Turno[]       @relation("PacienteTurnos")
}

// Modelo de Turno (asignación de citas)
model Turno {
  id          String   @id @default(uuid())
  pacienteId  String
  medicoId    String
  fecha       DateTime
  hora        String   // Hora del turno (formato HH:mm)
  lugar       String?  // Lugar de la cita
  observaciones String?
  estado      String   @default("PENDIENTE") // PENDIENTE, COMPLETADO, CANCELADO
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  paciente    Paciente @relation("PacienteTurnos", fields: [pacienteId], references: [id])
  medico      User     @relation("MedicoTurnos", fields: [medicoId], references: [id])
}

// Modelo de Junta Médica
model JuntaMedica {
  id                  String             @id @default(uuid())
  pacienteId          String
  medicoId            String
  estado              String             @default("BORRADOR") // BORRADOR, PENDIENTE, APROBADA, RECHAZADA
  fecha               DateTime           @default(now())
  hora                String?            // Hora del turno (formato HH:mm)
  fechaDictamen       DateTime?
  aptitudLaboral      String?            // apto, apto_con_restricciones, no_apto_temporario, no_apto_definitivo
  diagnosticoPrincipal String?
  observaciones       String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  
  paciente            Paciente           @relation("PacienteJuntas", fields: [pacienteId], references: [id])
  medico              User               @relation("MedicoJuntas", fields: [medicoId], references: [id])
  dictamen            Dictamen?
  documentos          DocumentoAdjunto[]
}

// Modelo de Dictamen (datos completos del cuestionario)
model Dictamen {
  id             String      @id @default(uuid())
  juntaId        String      @unique
  datosCompletos String      // JSON con todos los datos del cuestionario
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  
  junta          JuntaMedica @relation(fields: [juntaId], references: [id], onDelete: Cascade)
}

// Modelo de Documento Adjunto
model DocumentoAdjunto {
  id          String      @id @default(uuid())
  juntaId     String
  nombre      String
  tipo        String?     // Tipo MIME
  url         String
  categoria   String?     // EXAMEN_PSICOLOGICO, RESULTADOS_BIOQUIMICOS, etc.
  size        Int?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  junta       JuntaMedica @relation(fields: [juntaId], references: [id], onDelete: Cascade)
}
